# CLI-IDE API Reference

## Quick Start

### Running the Application

```python
from cli_ide import CliIdeApp

app = CliIdeApp("/path/to/project")
app.run()
```

### Using Components Independently

```python
from textual.app import App, ComposeResult
from cli_ide.widgets import Terminal, EditorPaneWidget, FileTree

class MyApp(App):
    def compose(self) -> ComposeResult:
        yield FileTree("/path/to/browse")
        yield EditorPaneWidget()
        yield Terminal()
```

---

## Core Classes

### CliIdeApp

Main application class that provides the complete IDE experience.

```python
from cli_ide import CliIdeApp

app = CliIdeApp(path: str | None = None)
```

**Parameters:**
- `path`: Root directory to open. Defaults to current working directory.

**Methods:**
- `open_file(path: Path) -> None`: Open a file in the active editor pane.
- `action_save_file() -> None`: Save the current file.
- `action_find_in_file() -> None`: Open the search bar.
- `action_find_in_project() -> None`: Open project-wide search dialog.

---

## Models

### EditorState

Manages the global editor state including panes and splits.

```python
from cli_ide import EditorState

state = EditorState()
```

**Properties:**
- `active_pane: EditorPane | None`: Currently active pane.
- `active_file: OpenFile | None`: Currently active file.
- `panes: list[EditorPane]`: All editor panes.
- `split_orientation: str`: "none", "horizontal", or "vertical".

**Methods:**
- `get_pane_by_id(pane_id: str) -> EditorPane | None`: Find pane by ID.

---

### EditorPane

Represents a single editor pane with tabs.

```python
from cli_ide import EditorPane

pane = EditorPane(id: str = <auto-generated>)
```

**Properties:**
- `open_files: dict[str, OpenFile]`: Files open in this pane.
- `active_file: str | None`: Path of the active file.
- `tab_order: list[str]`: Order of tabs.

**Methods:**
- `add_file(open_file: OpenFile) -> None`: Add a file to the pane.
- `remove_file(path: Path) -> str | None`: Remove a file, returns next file to activate.
- `get_next_file() -> str | None`: Get next file in tab order.
- `get_prev_file() -> str | None`: Get previous file in tab order.
- `get_file_at_index(index: int) -> str | None`: Get file at specific tab index.

---

### OpenFile

Represents an open file with its content and modification state.

```python
from cli_ide import OpenFile
from pathlib import Path

file = OpenFile(
    path=Path("/path/to/file.py"),
    content="file contents",
    original_content="file contents",
    language="python"  # optional
)
```

**Properties:**
- `is_modified: bool`: True if content differs from original.
- `display_name: str`: Filename with `*` prefix if modified.

---

### MultiSelectState

Tracks multi-cursor selection state.

```python
from cli_ide import MultiSelectState

ms = MultiSelectState()
```

**Properties:**
- `active: bool`: Whether multi-select mode is active.
- `target_text: str`: The text being multi-selected.
- `count: int`: Number of selections.
- `highlighted_positions: list[tuple[int, int]]`: (row, col) positions.

**Methods:**
- `add_position(row: int, col: int) -> bool`: Add a selection position.
- `reset() -> None`: Clear all selections.

---

## Widgets

### Terminal

PTY-based terminal emulator widget.

```python
from cli_ide.widgets import Terminal, TerminalInput

terminal = Terminal(working_dir: Path | None = None)
terminal_input = TerminalInput(terminal)
```

**Parameters:**
- `working_dir`: Initial directory. Defaults to `Path.cwd()`.

**Methods:**
- `send_key(key: str) -> None`: Send a key sequence to the shell.
- `send_text(text: str) -> None`: Send text to the shell.
- `resize_pty(cols: int, rows: int) -> None`: Resize the terminal.

**Note:** Requires `pyte` library.

---

### EditorPaneWidget

Self-contained editor widget with tabs and search.

```python
from cli_ide.widgets import EditorPaneWidget

pane = EditorPaneWidget(pane_id: str | None = None)
```

**Parameters:**
- `pane_id`: Unique identifier. Auto-generated if not provided.

**Methods:**
- `open_file(path: Path, content: str, language: str | None) -> None`: Open a file in a new tab.
- `close_tab(tab_id: str) -> None`: Close a tab.
- `show_search_bar(initial_text: str = "") -> None`: Show search bar.
- `hide_search_bar() -> None`: Hide search bar.
- `get_active_editor() -> TextArea | None`: Get the active TextArea widget.

**Messages:**
- `PaneFocused(pane_id: str)`: Sent when pane receives focus.

---

### FileTree

Directory tree browser widget.

```python
from cli_ide.widgets import FileTree

tree = FileTree(path: Path)
```

Inherits from Textual's `DirectoryTree`.

**Messages:**
- `FileSelected(path: Path)`: Sent when a file is selected.

---

### SearchBar

Inline search bar for find-in-file.

```python
from cli_ide.widgets import SearchBar

search = SearchBar()
```

**Methods:**
- `focus_input() -> None`: Focus the search input field.
- `set_query(text: str) -> None`: Set the search query.
- `set_status(text: str) -> None`: Update the status display.

**Messages:**
- `SearchSubmitted(query: str, direction: str)`: Search requested.
- `SearchClosed()`: Search bar closed.

---

### ProjectSearchDialog

Modal dialog for project-wide search.

```python
from cli_ide.widgets import ProjectSearchDialog

dialog = ProjectSearchDialog(root_path: Path)
```

Returns `"filepath:line_number"` string when a result is selected.

---

## Configuration

### Config

Application configuration with TOML file support.

```python
from cli_ide import Config

# Load from default locations
config = Config.load(project_path: Path | None = None)

# Access settings
config.editor.theme        # "light-ide"
config.editor.tab_size     # 4
config.terminal.height     # 14
config.sidebar.width       # 30
```

**Config File Locations:**
1. `~/.config/cli-ide/config.toml` (user config)
2. `.cli-ide.toml` (project config, overrides user)

**Example config.toml:**
```toml
[editor]
theme = "light-ide"
tab_size = 4
show_line_numbers = true

[terminal]
shell = ""  # Uses $SHELL
height = 14

[sidebar]
width = 30
visible = true
```

---

## Themes

### LIGHT_THEME

Default light theme for syntax highlighting.

```python
from cli_ide.themes import LIGHT_THEME

# Register with TextArea
editor.register_theme(LIGHT_THEME)
editor.theme = "light-ide"
```

### Terminal Colors

```python
from cli_ide.themes import PYTE_COLORS, PYTE_BRIGHT_COLORS
```

ANSI color mappings for terminal rendering.
